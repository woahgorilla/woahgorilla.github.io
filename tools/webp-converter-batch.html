<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="images/x-icon" href="https://woahgorilla.github.io/favicon.ico">
        <meta name="keywords" content="webp, image, converter, png, jpg, jpeg, javascript">
        <meta property="og:title" content="Free webp to png and jpeg converter">
        <meta property="og:site_name" content="WebP Converter">
        <meta property="og:description" content="Convert .webp files to png or jpg free with no uploads!">
        <meta name="description" content="Convert .webp files to png or jpg free with no uploads!">
        <meta name="author" content="Ultracat39">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Batch WebP Converter</title>
        <link rel="stylesheet" href="../woahgorilla.css">
    </head>
    <body>
        <h1>Batch WebP Converter</h1>
        <div class="box">
            <p>
            <input type="file" id="fileInput" multiple accept="image/webp">
            <br>            
                Convert image to:
                <select id="convertTo">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPEG/JPG</option>
                </select>
            </p>
            <p>
                <button id="reset" class="miniButton redButton">Clear</button>
                <button id="convert" class="miniButton greenButton">Convert</button>
            </p>
            <p>Only want to convert one image? Use the <a style="color:#149e9e;text-decoration:underline;" href="webp-converter.html">regular converter</a>!</p>
        </div>
        <h2>About</h2>
        <p style="max-width: 800px;">Convert all your .webp images to more usble formats for free with no uploads! Easily convert webp to png, or webp to jpg! This efficient converter will make quick work of all WebP images. No uploads means that everything is done on your device. This means that your images aren't used to train AI, stolen, or even seen by anyone else. Just a simple tool to convert .webp images to other, more useable, types.</p>
        <div class="hidden">
            <a id="dummyDownloadLink"></a>
            <canvas id="canvas">your browser does not support canvas (which is needed for this to work)</canvas>
        </div>
        <p style="text-align: center; max-width: 600px; margin: 20px auto;">
            Made by Ultracat39<br><br><a href="https://woahgorilla.github.io/" style="color:#149e9e;text-decoration:underline;">Back to home page</a>
        </p>
        <script src="client-zip.js"></script>
        <script>
            let type;
            const fileInput = document.getElementById('fileInput');
            const canvas = document.getElementById('canvas');
            const convertButton = document.getElementById('convert');
            const resetButton = document.getElementById('reset');
            let ctx = canvas.getContext('2d');
            const imgTypeSelector = document.getElementById('convertTo');
            let zipfiles = [];
            convertButton.onclick = function() {
                zipfiles = [];
                type = imgTypeSelector.value;
                const files = fileInput.files;
                for (let i = 0; i < files.length; i++) {
                    const fileName = files[i].name.split('.')[0] + '.' + type;
                    window.createImageBitmap(files[i]).then(function (img) {
                        canvas.height = img.height;
                        canvas.width = img.width;
                        ctx.drawImage(img, 0, 0);
                        addCanvasBlobToZip(fileName);
                    });
                }
            }
            function addCanvasBlobToZip(name){
                let canvasBlob = canvas.toBlob((blob) => {
                    let fileObject = new Object();
                    fileObject.name = name;
                    fileObject.input = blob;
                    zipfiles.push(fileObject);
                    if (zipfiles.length == fileInput.files.length) {
                        let a = document.getElementById('dummyDownloadLink');
                        downloadZip(zipfiles).blob().then(function (blob) {
                            a.href = window.URL.createObjectURL(blob);
                            a.download = "result.zip";
                            a.click();
                        });
                        for (let i = 0; i < zipfiles.length; i++) {
                            URL.revokeObjectURL(zipfiles[i].input);
                        }
                        URL.revokeObjectURL(a.href);
                    }
                }, 'image/'+type);
            }

            resetButton.onclick = function() {
                fileInput.value = null;
            }
            
            </script>
    </body>
</html>