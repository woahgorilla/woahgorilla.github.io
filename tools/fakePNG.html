<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="images/x-icon" href="https://woahgorilla.github.io/favicon.ico">
        <meta name="keywords" content="fake png, fake transparent, fake, png, transparent, prank, javascript">
        <meta property="og:title" content="Fake transparent PNG maker">
        <meta property="og:site_name" content="Fake transparent PNG maker">
        <meta property="og:description" content="Make your PNG images into those fake ones with the squares in the background!">
        <meta name="description" content="Make your PNG images into those fake ones with the squares in the background!">
        <meta name="author" content="Ultracat39">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Fake PNG maker</title>
        <link rel="stylesheet" href="../woahgorilla.css">
    </head>
    <body>
        <h1>Fake PNG Creater</h1>
        <div class="box">
            <p>
                <input type="file" id="fileInput" accept="image/png">
                <br>
                Download product as:
                <select id="convertTo">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPEG/JPG</option>
                </select>
                <div class="slidecontainer">
                    <p id="pixelsDisplay">Pixels per square: 30</p>
                        <input type="range" min="1" max="100" value="30" class="slider" id="pixelsSlider">
                </div>
            </p>
            <p>
                <button id="reset" class="miniButton redButton">Clear</button>
                <button id="convert" class="miniButton greenButton">Create</button>
            </p>
        </div>
        <h2>About</h2>
        <p style="max-width: 800px;">Make your PNG images into those stupid fake ones you always see on google images with the background that's just a bunch of grey squares. Go and annoy people with these fake PNG thingies or something.</p>
        <p style="text-align: center; max-width: 600px; margin: 20px auto;">
            Made by Ultracat39<br><br><a href="https://woahgorilla.github.io/" style="color:#149e9e;text-decoration:underline;">Back to home page</a>
        </p>
        <div class="hidden">
            <a id="dummyDownloadLink"></a>
            <canvas id="canvas" class="hidden">your browser does not support canvas (which is needed for this to work)</canvas>
        </div>
        <script>
            let type;
            const fileInput = document.getElementById('fileInput');
            const canvas = document.getElementById('canvas');
            const convertButton = document.getElementById('convert');
            const resetButton = document.getElementById('reset');
            let ctx = canvas.getContext('2d');
            const imgTypeSelector = document.getElementById('convertTo');
            const squareSizeSlider = document.getElementById('pixelsSlider');
            const pixelsDisplay = document.getElementById('pixelsDisplay');

            convertButton.onclick = function() {
                type = imgTypeSelector.value;
                const files = fileInput.files;
                for (let i = 0; i < files.length; i++) {
                    const fileName = files[i].name.split('.')[0] + '.' + type;
                    window.createImageBitmap(files[i]).then(function (img) {
                        canvas.height = img.height;
                        canvas.width = img.width;
                        let squareGrey = true;
                        const squareSize = squareSizeSlider.value;
                        const squaresX = Math.ceil(canvas.width / squareSize);
                        const squaresY = Math.ceil(canvas.height / squareSize);
                        let augmentPattern = true; 
                        if (squaresY % 2 == 1) {
                            augmentPattern = false;
                        }
                        for (let i = 0; i < squaresX; i++) {
                            let x = i * squareSize;
                            for (let v = 0; v < squaresY; v++) {
                                let y = v * squareSize;
                                if (squareGrey) {
                                    ctx.fillStyle = '#cfcfcf';
                                } else {
                                    ctx.fillStyle = '#ffffff';
                                }
                                ctx.fillRect(x, y, squareSize, squareSize);
                                squareGrey = !squareGrey;
                            }
                            if (augmentPattern) {
                                squareGrey = !squareGrey;
                            }
                        }
                        ctx.drawImage(img, 0, 0);

                        downloadCanvasAsImage(fileName);
                    });
                }
            }
            
            function downloadCanvasAsImage(name){
                let canvasImage = canvas.toDataURL('image/'+type);
                let a = document.getElementById('dummyDownloadLink');

                let xhr = new XMLHttpRequest();
                xhr.responseType = 'blob';
                xhr.onload = function () {
                    a.href = window.URL.createObjectURL(xhr.response);
                    a.download = name;
                    a.click();
                };
                xhr.open('GET', canvasImage);
                xhr.send();
            }

            squareSizeSlider.onchange = function() {
                pixelsDisplay.innerText = 'Pixels per square: ' + squareSizeSlider.value
            }

            resetButton.onclick = function() {
                fileInput.value = null;
                squareSizeSlider.value = 30
                pixelsDisplay.innerText = 'Pixels per square: ' + squareSizeSlider.value
            }
        </script>
    </body>
</html>
