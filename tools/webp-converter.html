<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="images/x-icon" href="https://woahgorilla.github.io/favicon.ico">
        <meta name="keywords" content="webp, image, converter, png, jpg, jpeg, javascript">
        <meta property="og:title" content="Free webp to png and jpeg converter">
        <meta property="og:site_name" content="WebP Converter">
        <meta property="og:description" content="Convert .webp files to png or jpg free with no uploads!">
        <meta name="description" content="Convert .webp files to png or jpg free with no uploads!">
        <meta name="author" content="Ultracat39">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>WebP Converter</title>
        <link rel="stylesheet" href="../woahgorilla.css">
    </head>
    <body>
        <h1>WebP Converter</h1>
        <div class="box">
            <p>
                <input type="file" id="fileInput" accept="image/webp">
                <br>
                Convert image to:
                <select id="convertTo">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPEG/JPG</option>
                </select>
            </p>
            <p>
                <button id="reset" class="miniButton redButton">Clear</button>
                <button id="convert" class="miniButton greenButton">Convert</button>
            </p>
            <p>Want to convert a buch of images at once? Use the <a style="color:#149e9e;text-decoration:underline;" href="webp-converter-batch.html">batch converter</a>!</p>
        </div>
        <h2>About</h2>
        <p style="max-width: 800px;">Convert your webp images to more usble formats for free with no uploads! Easily convert webp to png, or webp to jpg! This efficient converter will make quick work of all WebP images. No uploads means that everything is done on your device. This means that your images aren't used to train AI, stolen, or even seen by anyone else. Just a simple tool to convert .webp images to other, more useable, types.</p>
        <div class="hidden">
            <a id="dummyDownloadLink"></a>
            <canvas id="canvas">your browser does not support canvas (which is needed for this to work)</canvas>
        </div>
        <p style="text-align: center; max-width: 600px; margin: 20px auto;">
            Made by Ultracat39<br><br><a href="https://woahgorilla.github.io/" style="color:#149e9e;text-decoration:underline;">Back to home page</a>
        </p>
        <script>
            let type;
            const fileInput = document.getElementById('fileInput');
            const canvas = document.getElementById('canvas');
            const convertButton = document.getElementById('convert');
            const resetButton = document.getElementById('reset');
            let ctx = canvas.getContext('2d');
            const imgTypeSelector = document.getElementById('convertTo');
            convertButton.onclick = function() {
                type = imgTypeSelector.value;
                const files = fileInput.files;
                for (let i = 0; i < files.length; i++) {
                    const fileName = files[i].name.split('.')[0] + '.' + type;
                    window.createImageBitmap(files[i]).then(function (img) {
                        canvas.height = img.height;
                        canvas.width = img.width;
                        ctx.drawImage(img, 0, 0);

                        downloadCanvasAsImage(fileName);
                    });
                   // img.then(processBitmap(img));
                }
            }
            
            function downloadCanvasAsImage(name){
                let canvasImage = canvas.toDataURL('image/'+type);
                let a = document.getElementById('dummyDownloadLink');

                let xhr = new XMLHttpRequest();
                xhr.responseType = 'blob';
                xhr.onload = function () {
                    a.href = window.URL.createObjectURL(xhr.response);
                    a.download = name;
                    a.click();
                };
                xhr.open('GET', canvasImage);
                xhr.send();
            }

            resetButton.onclick = function() {
                fileInput.value = null;
            }
        </script>
    </body>
</html>